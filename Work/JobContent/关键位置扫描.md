# 快速扫描调研文档

## 1. 快速扫描

​		在Linux系统下的病毒扫描软件设计中，“快速扫描”是一个重要的功能模块，旨在以**较短的时间**检测系统中可能存在的**高危威胁**。快速扫描需要聚焦于系统的核心区域，这些区域通常是恶意软件优先攻击或利用的部分，以实现持久化驻留、实时执行或隐藏痕迹。

### 1.1 linux系统架构

<img src="source/images/%E5%85%B3%E9%94%AE%E4%BD%8D%E7%BD%AE%E6%89%AB%E6%8F%8F/eed5a6713e374f68b4ff57c728b3da72.png" alt="linux系统架构" style="zoom: 50%;" />

由系统架构可知，用户任务通过系统调用获取内核服务，所以可以采用"由浅入深"的设计手法，让快速扫描在覆盖主要威胁点的同时保持轻量

### 1.2 快速扫描的设计思路

快速扫描的目标是高效检测潜在威胁，避免全面扫描带来的性能开销。基于恶意软件的行为特征，快速扫描应优先关注以下三个方面：

1. **实时威胁**：通过<u>内存扫描</u>检测当前运行的恶意进程或内核模块。
2. **持久化机制**：通过<u>关键位置扫描</u>检查开机启动项和定时任务，确保恶意软件无法在系统重启或特定时间复活。
3. **高危文件**：扫描<u>可执行文件、脚本和核心配置文件</u>，识别可能的恶意代码或篡改痕迹。

所以快速扫描包含三大模块：**内存扫描**、**关键位置扫描**和**文件扫描**。



## 2. 内存/进程扫描

内存扫描用于检测当前正在运行的恶意进程或被加载的恶意内核模块。这是发现实时威胁的最直接方式，因为大多数恶意软件需要在内存中执行以实现其功能。

**扫描目标**

1. **运行中的进程**：检查异常进程的命令行参数、文件路径和网络连接。
   - 检查`/proc/`，进程文件放在该路径下
2. **内核模块和驱动**：检测非官方或可疑的内核模块加载。
   - `/proc/modules`、`/lib/modules`



## 3. 关键位置扫描

所谓“关键位置”，指的是系统中可能被恶意软件利用以实现持久化驻留、自动执行或隐藏痕迹的区域。关键位置扫描关注系统启动和定时执行的配置，是恶意软件实现持久化的常见手段。尽管生产服务器重启较少，恶意软件仍可能通过开机启动项作为失联后的恢复机制，或利用定时任务隐秘执行。因此，这一模块对于快速发现潜在威胁至关重要。

**扫描目标与子模块**

1. **开机启动项/系统服务**
   - Systemd系统服务：`/etc/systemd/system/`、`/lib/systemd/system/`等（检查`.service`文件中的`ExecStart`字段）
   - SysVinit系统服务：`/etc/init.d/`等（分析脚本内容）

2. **定时任务**
   - 用户crontab：`/var/spool/cron/`（如`/var/spool/cron/root`）
   - 系统crontab：`/etc/crontab`
   - 定时任务脚本：`/etc/cron.d/`、`/etc/cron.daily/`、`/etc/cron.hourly/`等。



## 4. 文件扫描

文件扫描针对系统中可能被篡改或植入恶意代码的高危文件类型，尤其是可执行文件、脚本和核心配置文件。这些文件可能是恶意软件的落脚点或执行入口，快速扫描需覆盖关键部分以识别潜在威胁。

**扫描目标**

1. **可执行文件和脚本**：检查常见存放路径是否存在异常二进制文件或脚本。
   - `/bin/`、`/usr/bin/`、`/usr/local/bin/`等（检查文件签名或权限异常）
2. **核心配置文件**：检测系统关键配置文件是否被篡改，如环境变量配置文件、用户配置文件、特殊系统文件(账号密码)
   - `/etc/passwd`（用户账号）、`/etc/sudoers`等（权限提升配置）。
3. **日志文件**：快速检查日志中是否有异常登录或命令执行记录。
   - `/var/log/auth.log`、`/var/log/syslog`等（快速检索可疑记录）
4. **用户相关文件**
5. **网络和web服务器相关目录文件**



## 5. 总结

综上所述：

快速扫描：内存扫描(进程、内核扫描) -> 关键位置扫描(开机启动/系统服务和定时) -> 文件扫描(可执行文件和脚本、配置文件、日志文件、用户文件等)

关键位置扫描：开机启动项和定时任务